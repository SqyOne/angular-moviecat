(function (angular) {
	'use strict';

	// var data = [{"count": 3, "start": 0, "total": 18, "subjects": [{"rating": {"max": 10, "average": 7.6, "stars": "40", "min": 0}, "genres": ["\u52a8\u753b", "\u5947\u5e7b", "\u5192\u9669"], "title": "\u9a6f\u9f99\u9ad8\u624b3", "casts": [{"alt": "https:\/\/movie.douban.com\/celebrity\/1002664\/", "avatars": {"small": "https://img3.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p893.webp", "large": "https://img3.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p893.webp", "medium": "https://img3.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p893.webp"}, "name": "\u6770\u4f0a\u00b7\u5df4\u9c81\u5207\u5c14", "id": "1002664"}, {"alt": "https:\/\/movie.douban.com\/celebrity\/1000055\/", "avatars": {"small": "https://img3.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p28644.webp", "large": "https://img3.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p28644.webp", "medium": "https://img3.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p28644.webp"}, "name": "\u4e9a\u7f8e\u8389\u5361\u00b7\u8d39\u96f7\u62c9", "id": "1000055"}, {"alt": "https:\/\/movie.douban.com\/celebrity\/1055073\/", "avatars": {"small": "https://img1.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p1425119644.17.webp", "large": "https://img1.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p1425119644.17.webp", "medium": "https://img1.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p1425119644.17.webp"}, "name": "F\u00b7\u9ed8\u91cc\u00b7\u4e9a\u4f2f\u62c9\u7f55", "id": "1055073"}], "collect_count": 66266, "original_title": "How To Train Your Dragon: The Hidden World", "subtype": "movie", "directors": [{"alt": "https:\/\/movie.douban.com\/celebrity\/1018302\/", "avatars": {"small": "https://img1.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p18169.webp", "large": "https://img1.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p18169.webp", "medium": "https://img1.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p18169.webp"}, "name": "\u8fea\u6069\u00b7\u5fb7\u5e03\u6d1b\u65af", "id": "1018302"}], "year": "2019", "images": {"small": "https://img3.doubanio.com\/view\/photo\/s_ratio_poster\/public\/p2546335362.webp", "large": "https://img3.doubanio.com\/view\/photo\/s_ratio_poster\/public\/p2546335362.webp", "medium": "https://img3.doubanio.com\/view\/photo\/s_ratio_poster\/public\/p2546335362.webp"}, "alt": "https:\/\/movie.douban.com\/subject\/19899707\/", "id": "19899707"}, {"rating": {"max": 10, "average": 8.9, "stars": "45", "min": 0}, "genres": ["\u5267\u60c5", "\u559c\u5267", "\u4f20\u8bb0"], "title": "\u7eff\u76ae\u4e66", "casts": [{"alt": "https:\/\/movie.douban.com\/celebrity\/1054520\/", "avatars": {"small": "https://img3.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p29922.webp", "large": "https://img3.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p29922.webp", "medium": "https://img3.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p29922.webp"}, "name": "\u7ef4\u679c\u00b7\u83ab\u817e\u68ee", "id": "1054520"}, {"alt": "https:\/\/movie.douban.com\/celebrity\/1004702\/", "avatars": {"small": "https://img3.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p1488440651.5.webp", "large": "https://img3.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p1488440651.5.webp", "medium": "https://img3.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p1488440651.5.webp"}, "name": "\u9a6c\u8d6b\u6c99\u62c9\u00b7\u963f\u91cc", "id": "1004702"}, {"alt": "https:\/\/movie.douban.com\/celebrity\/1010545\/", "avatars": {"small": "https://img3.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p1405786644.35.webp", "large": "https://img3.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p1405786644.35.webp", "medium": "https://img3.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p1405786644.35.webp"}, "name": "\u7433\u8fbe\u00b7\u5361\u5fb7\u91cc\u5c3c", "id": "1010545"}], "collect_count": 284903, "original_title": "Green Book", "subtype": "movie", "directors": [{"alt": "https:\/\/movie.douban.com\/celebrity\/1036662\/", "avatars": {"small": "https://img3.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p29610.webp", "large": "https://img3.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p29610.webp", "medium": "https://img3.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p29610.webp"}, "name": "\u5f7c\u5f97\u00b7\u6cd5\u96f7\u91cc", "id": "1036662"}], "year": "2018", "images": {"small": "https://img3.doubanio.com\/view\/photo\/s_ratio_poster\/public\/p2549177902.webp", "large": "https://img3.doubanio.com\/view\/photo\/s_ratio_poster\/public\/p2549177902.webp", "medium": "https://img3.doubanio.com\/view\/photo\/s_ratio_poster\/public\/p2549177902.webp"}, "alt": "https:\/\/movie.douban.com\/subject\/27060077\/", "id": "27060077"}, {"rating": {"max": 10, "average": 7.6, "stars": "40", "min": 0}, "genres": ["\u52a8\u4f5c", "\u79d1\u5e7b", "\u5192\u9669"], "title": "\u963f\u4e3d\u5854\uff1a\u6218\u6597\u5929\u4f7f", "casts": [{"alt": "https:\/\/movie.douban.com\/celebrity\/1342762\/", "avatars": {"small": "https://img3.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p1501911452.02.webp", "large": "https://img3.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p1501911452.02.webp", "medium": "https://img3.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p1501911452.02.webp"}, "name": "\u7f57\u838e\u00b7\u8428\u62c9\u67e5", "id": "1342762"}, {"alt": "https:\/\/movie.douban.com\/celebrity\/1054405\/", "avatars": {"small": "https://img3.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p26974.webp", "large": "https://img3.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p26974.webp", "medium": "https://img3.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p26974.webp"}, "name": "\u514b\u91cc\u65af\u6258\u5f17\u00b7\u6c83\u5c14\u5179", "id": "1054405"}, {"alt": "https:\/\/movie.douban.com\/celebrity\/1399007\/", "avatars": {"small": "https://img3.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p1549880660.24.webp", "large": "https://img3.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p1549880660.24.webp", "medium": "https://img3.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p1549880660.24.webp"}, "name": "\u57fa\u6069\u00b7\u7ea6\u7ff0\u900a", "id": "1399007"}], "collect_count": 295485, "original_title": "Alita: Battle Angel", "subtype": "movie", "directors": [{"alt": "https:\/\/movie.douban.com\/celebrity\/1019016\/", "avatars": {"small": "https://img1.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p1378050540.89.webp", "large": "https://img1.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p1378050540.89.webp", "medium": "https://img1.doubanio.com\/view\/celebrity\/s_ratio_celebrity\/public\/p1378050540.89.webp"}, "name": "\u7f57\u4f2f\u7279\u00b7\u7f57\u5fb7\u91cc\u683c\u5179", "id": "1019016"}], "year": "2019", "images": {"small": "https://img3.doubanio.com\/view\/photo\/s_ratio_poster\/public\/p2544987866.webp", "large": "https://img3.doubanio.com\/view\/photo\/s_ratio_poster\/public\/p2544987866.webp", "medium": "https://img3.doubanio.com\/view\/photo\/s_ratio_poster\/public\/p2544987866.webp"}, "alt": "https:\/\/movie.douban.com\/subject\/1652592\/", "id": "1652592"}], "title": "\u6b63\u5728\u4e0a\u6620\u7684\u7535\u5f71-\u5317\u4eac"}];
	// 创建正在热映模块
	var module = angular.module('moviecat.list', ['ngRoute', 'moviecat.service.http']);
    // 配置模块的路由
	module.config(['$routeProvider', function($routeProvider) {
			$routeProvider.when('/:category/:page', {
				templateUrl: 'movie_list/view.html',
				controller: 'movieListController'
			});
		}]);

	module.controller('movieListController', [
			'$scope',
			'$route',
			'$routeParams',
			'HttpService',
			'AppConfig',
			function($scope, $route, $routeParams, HttpService, AppConfig) {
				var count = AppConfig.pageSize;	// 每一页的条数
				var page = parseInt($routeParams.page);	// 当前第几页
				var start = (page-1) * count;	//	当前页从哪开始
				// 控制器分为两步：1. 设计暴露数据	2. 设计暴露行为
				$scope.loading = true;
				$scope.subjects = [];
				$scope.title = 'Loading...';
				$scope.message = '';
				$scope.totalCount = 0;
				$scope.totalPages = 0;
				$scope.currentPage = page;
				HttpService.jsonp(AppConfig.listApiAddress + $routeParams.category,
					// $routeParams的数据来源： 1. 路由匹配出来的 2. 问号后面的参数
					{start:start, count:count, q: $routeParams.q}, function (data) {
					$scope.subjects = data.subjects;
					$scope.title = data.title;
					$scope.totalCount = data.total;
					$scope.totalPages = Math.ceil($scope.totalCount / count);
					$scope.loading = false;
					$scope.$apply();
				//	$apply的作用就是让指定的表达式重新同步，不用写参数，所有数据都会同步
				});
				// 暴露一个上一页下一页的行为
				$scope.go = function (page) {
					// 一定要做一个合法范围校验
					if (page >= 1 && page <= $scope.totalPages) {
						// 传过来第几页我就跳到第几页
						$route.updateParams({page:page});
					}
				}
			}
		]);
})(angular);


/*var doubanApiAddress = 'https://api.douban.com/v2/movie/in_theaters';
				// 涉及到跨域所以不能用get要用jsonp
				// 在angular中使用jsonp的方式做跨域请求，就必须给当前地址加上一个参数 callback=JSON_CALLBACK
				$http.jsonp(doubanApiAddress+'?callback=JSON_CALLBACK').then(function (res) {
					// 此处的代码是在异步请求完成过后才执行（需要等一段时间再执行）
					console.log(res);
					if (res.status == 200) {
						$scope.subjects = res.data.subjects;
					} else {
						$scope.message = '获取数据错误，错误信息' + res.statusText;
					}
				}, function (err) {
					console.log(err);
					$scope.message = '获取数据错误，错误' + err.statusText;
				});*/

/*// 测试 http服务
$http.get('/06Node/moviecat/app/datas/in_theathers.json').then(function (res) {
    // 此处的代码是在异步请求完成过后才执行（需要等一段时间再执行），
    if (res.status == 200) {
        $scope.subjects = res.data.subjects;
    } else {
        $scope.message = '获取数据错误，错误信息' + res.statusText;
    }
}, function (err) {
    console.log(err);
    $scope.message = '获取数据错误，错误信息' + err.statusText;
});*/
